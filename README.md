# 🎯抖音视频下载器(Douyin Video Downloader)
* 本脚本能下载抖音APP端禁止下载的视频

* 本脚本能下载无水印视频，在抖音网页版"首页"、"推荐页"、视频"详情页"、其他"频道页"、"热点页"、"搜索页"、"移动端分享页"添加下载按钮

* 本脚本能批量下载无水印视频（需fdm等下载器配合使用，具体操作查看下方“使用流程”的“三”）

* 本脚本能提取抖音直播间真实推流地址，能屏蔽直播间影响观看直播的不必要组件

* 本脚本能展开页面左侧侧栏所有选项,屏蔽一些非必要的弹窗(强制登录页面、登录提示、满意度调查等)

* 本本脚本适用于PC端Chrome、Edge、华为浏览器(HWbrowser)等,移动端Kiwi、猴狐等

* 本脚本仅供学习交流使用,切勿商用！！！本人只是js爱好者，不是专业开发者，如果有大佬想帮忙优化、更新代码可以通过github联系我

* 注意！！！2021.12月以来，抖音网页版增加了严格的csp限制，本脚本将暂时不再支持via浏览器、adguard等无法使用油猴/篡改猴/暴力猴的浏览器/app

# 📖使用流程
一、电脑端(或浏览器UA为电脑UA):

1、打开抖音网页版(https://www.douyin.com)

2、不同页面，下载图标位置不同:

(1)推荐页或关注页:点击右下角三个点,选择下载

(2)首页、频道页、热点页或搜索页:每个视频作者名边上都有下载按钮,点击下载;或者也可以点击视频进入详情页,参考(3)下载

(3)详情页:视频名下方，分享按钮右侧为下载按钮

(4)直播页:位于直播间标题右侧，“手机观看”按钮左侧。

3、推荐页或关注页也可以键盘按下“Shift+D”快速下载。

<br>

二、移动端(或浏览器UA为手机等移动端UA)

1、打开移动端分享页URL（注意：这里仅仅指视频分享，直播间分享请使用pc版网页）

2、点击右下角三个点打开“更多操作”

3、点击下载按钮

<br>

三、批量导出下载

1、点击页面右下角“扳手图标”进入脚本设置页面，找到“批量导出”选项，点击后面的“点击导出地址”。或者，也可以键盘按下“Shift+A+D”快速导出。

2、完成步骤1，当前页面已解析成功的视频地址均导出到了剪贴板。打开第三方下载器，如fdm、idm等。

3、以fdm（Free Download Manager）为例。点击fdm软件右上角三个小短横，点击“从剪贴板粘贴”，点击“下载”。

四、快捷键功能汇总（持续更新中）

1、快速下载/打开视频：Shift+D

2、快速批量导出视频地址：Shift+A+D

3、快速打开设置页：Shift+S

# 💊问题解答
Q1:没有出现“下载”图标

A1:按照以下方法解决

(1)请确认本脚本已启用(尽量使用主流脚本管理器,如Tampermonkey、Violentmonkey)

(2)关闭广告拦截插件,脚本可能被广告插件误拦截

(3)多刷新下页面,有时候就很迷,油猴匹配不到脚本,需要二次刷新才能使用

(4)使用Edge浏览器与Tampermonkey

(5)如果都没用,按F12将控制台信息以及页面窗口截图通过Greasyfork/Github反馈给我

<br>

Q2:点击下载按钮无反应

A2:所有页面都支持在脚本设置页面导出视频链接。将导出的链接粘贴到第三方下载器下载

(1)移动端分享页:点击右下角三个点，长按下载按钮打开设置页，点击批量导出文字后面的“点击导出地址”

(2)桌面端网页:点击右下角形似“扳手”的图标打开设置页，点击批量导出文字后面的“点击导出地址”

<br>

Q3:无法自动下载

A3:安装脚本时候没有给予脚本下载权限，建议重装脚本。

<br>

Q4:直播视频如何下载/观看?（获取的直播推流视频地址如何使用）

A4:一、下载。如果为m3u8格式，请使用第三方m3u8下载器下载视频，比如IDM、FDM等。具体什么是m3u8格式视频自行百度；如果为flv格式，可以直接将链接粘贴在浏览器中，浏览器会自动在后台下载直播视频。以上两种下载模式均是在后台下载视频，不影响用户本身对电脑的操作。二、观看。直接将地址复制到第三方播放器即可观看。比如potplayer、或一些在线播放器。

<br>

Q5:浏览器提示“部分功能可能无法在此浏览器上使用”，页面上没有下载按钮

A5:在2021.12.1抖音更新后，抖音网页版增加了非常严格CSP用于限制第三方脚本，因此，不是通过TM/VM/GM安装使用本脚本的浏览器将不能使用本脚本大部分功能。

<br>

Q6:设置页看不懂设置项或不了解设置项功能

A6:鼠标悬停在设置选项上会有简单的功能介绍/提示信息

<br>

# 🔔特别声明
* 本人业余时间开发，并非专业开发者，代码质量可能不佳。如果有大佬想帮忙优化，可以联系我QwQ

* 本脚本随缘更新。若无bug或业余时间不足,可能没时间更新脚本

* 测试用平台:Windows系统Edge浏览器Tampermonkey脚本管理器

* 再次提醒:本脚本仅供学习交流使用!切勿商用!切勿商用!切勿商用!

# 🌎相关地址
* 更新日志: https://github.com/IcedWatermelonJuice/Douyin-Video-Downloader#更新日志
* Greasyfork仓库: https://greasyfork.org/scripts/431344
* Github项目仓库: https://github.com/IcedWatermelonJuice/Douyin-Video-Downloader
* Greasyfork安装：https://greasyfork.org/scripts/431344-抖音视频下载器.user.js
* Github正式版安装：https://github.com/IcedWatermelonJuice/Douyin-Video-Downloader/raw/main/抖音视频下载器.user.js
* Github测试版安装: https://github.com/IcedWatermelonJuice/Douyin-Video-Downloader/raw/main/test/抖音视频下载器.user.js
* (镜像)更新日志: https://hub.fastgit.org/IcedWatermelonJuice/Douyin-Video-Downloader#更新日志
* (镜像)Github项目仓库: https://hub.fastgit.org/IcedWatermelonJuice/Douyin-Video-Downloader
* (镜像)Github正式版安装: https://hub.fastgit.org/IcedWatermelonJuice/Douyin-Video-Downloader/raw/main/抖音视频下载器.user.js
* (镜像)Github测试版安装: https://hub.fastgit.org/IcedWatermelonJuice/Douyin-Video-Downloader/raw/main/test/抖音视频下载器.user.js

# 🔍参考截图
* 从左往右(从上往下)依次为:推荐页、详情页、频道页、移动端分享页、直播页
![推荐页](https://user-images.githubusercontent.com/87429695/130788855-0a08659d-bce2-412c-ae24-bff209fbb33d.png)
![详情页](https://user-images.githubusercontent.com/87429695/130788874-be412740-a314-4616-8a86-5e9fad8b9889.png)
![频道](https://user-images.githubusercontent.com/87429695/130845639-ad4afe36-f594-4d3b-9994-bd5e2881a7b8.png)
![移动端分享页](https://user-images.githubusercontent.com/87429695/144696090-080ad982-5d45-42c5-9c64-df9132c69634.png)
![直播页](https://user-images.githubusercontent.com/87429695/144091848-dedbc52a-dfcc-45c5-8beb-e6fcdac77ae7.PNG)

# 📕更新日志
<版本 1.38> 2022.04.03
* 新增批量导出快捷键shift+a+d
* 抖音主页dom结构大改，因此大幅修改主页相关代码
* 增加对用户主页（user页）的批量导出功能的支持
* 优化算法

<版本 1.37> 2022.02.11
* 根据抖音新dom结构调整算法
* 增加对综艺详情页的支持
* （补丁1）优化代码，修复分享菜单内短链按钮丢失的问题，修复直播页下载按钮样式问题
* （补丁1）增加两个快捷方式：shift+d快速下载当前视频，shift+s快速打开设置菜单
* （补丁2、3）优化精简代码，并根据抖音dom结构微调
* （补丁4）修复了在推荐页、关注页直接点击用户头像进入主页快速切换视频后，下载按钮不刷新的问题
* （补丁5）增加一个启用列表，默认全部启动
* （补丁6）优化主页、热点、频道页加载速度
* （补丁6）修改批量导出视频方式。现在导出地址以回车方式分段

<版本 1.36> 2021.12.30
* 修复搜索页下载按钮丢失的问题（抖音网页dom结构有了变化）
* 优化部分算法

<版本 1.35> 2021.12.30
* 调用油猴API重命名文件自动下载视频
* 调整视频解析方式，现在可以自由选择视频分辨率
* 其他一些bug修复

<版本 1.34> 2021.12.21
* 更改jQuery库来源
* 设置页增加“视频解析”选项，可选择“快速解析或高码率解析”。快速解析不保证视频分辨率及码率，但解析速度快，资源占用小。高码率解析将获取最高码率视频，但解析速度慢，资源占用高
* 直播页增加分享直播间功能，可在设置中选择分享直播间完整长链接还是通过第三方接口缩短后的短链接
* 设置页保存并应用功能修改。现在点击后直接保存设置，并提示用户是否通过刷新页面应用设置。用户可以选择取消刷新，通过点击设置中的重载链接来应用下载相关的设置
* 部分页面图标、设置页样式修改

<版本 1.33> 2021.12.11
* 修复详情页按钮丢失问题
* 修复详情页切换下一个视频，下载按钮还是上一个视频的问题

<版本 1.32> 2021.12.5
* 设置页增加一个刷新按钮功能。如果下载链接失效，可以尝试点击此按钮重新获取视频链接
* 设置页在部分页面增加批量导出功能
* 优化登录弹窗屏蔽功能（如果不喜欢这个功能，可以在设置页关闭）
* 修复视频详情页分享功能失效的问题
* 直播间真实推流地址如果强制选择flv或m3u8，则默认提取原画画质视频流地址

<版本 1.31> 2021.12.4
* 修复移动分享页按钮问题（现在操作方法：点击右下角三个点，点击下载图标）
* 对抖音原生的分享功能优化。原分享页面中的复制按钮名称变更为“口令”，功能不变；增加“短链”按钮，点击直接复制分享短链。
* 优化部分页面算法

<版本 1.30> 2021.12.1
* 修复下载按钮丢失、失效、错位的问题
* 部分页面采用jquery跨域请求（导致部分页面功能在via等浏览器上无法使用）

<版本 1.29> 2021.12.1
* 修复登录面板打不开的问题
* 设置页新增登录弹窗相关设置
* 直播间设置页新增直播推流视频格式设置
* 部分样式优化
* 新增一部分关键点的控制台输出，便于后续排查问题

<版本 1.28> 2021.12.1
* 支持提取抖音直播间真实推流地址
* 算法优化，并修复了部分bug

<版本 1.27> 2021.11.30
* 直播页详情增加一个设置页
* 沉浸式观看模式支持自定义，支持自动启动
* 沉浸式观看模式增加对聊天窗口的隐藏
* 移除原本的相关直播隐藏/显示功能
* 设置页样式优化

<版本 1.26> 2021.11.28
* 增加一个设置页。设置页入口位于右下角(抖音网页版的“意见反馈边上”)，图标为一倾斜扳手。
* 设置页支持自定义是否自动下载
* 设置页支持自定义是否自动下载时重命名的格式（“完整”、“仅视频名”、“数字id”）

<版本 1.25> 2021.11.27
* 下载的视频如果能获取到视频相关信息，则保存为“视频名+@+作者名.mp4”；如果获取不到视频相关信息，则保存为“抖音无水印视频.mp4”
* 视频路径增加对字节CDN的支持（zjcdn.com）
* swiper类型播放器（推荐页、关注页）相关算法改进

<版本 1.24> 2021.11.26
* 修复由于抖音结构大改导致的按钮全部失效的问题
* 直播间增加“沉浸式观看”按钮，可以隐藏所有与直播无关的内容，提高观看体验

<版本 1.23> 2021.11.12
* 修复部分页面下载按钮失效问题
* 修复直播间无法自动隐藏相关直播的问题

<版本 1.22> 2021.11.10
* 解决移动端分享页下载按钮丢失的问题

<版本 1.21> 2021.10.22
* 修复按钮错位bug
* 建议1.20版本升级到1.21版本

<版本 1.20> 2021.10.21
* 紧急修复下载器突然无法使用的问题

<版本 1.19> 2021.10.15
* 增加了当UA为pc时，对iesdouyin.com下detail页的支持
* 增加了跳转功能，当UA从mobile切换至pc时，会提示是否转跳pc页
* 修复了移动设备ua时，用户登录弹窗误屏蔽的问题
* 优化了部分代码

<版本 1.18> 2021.10.15
* 优化代码
* 修复了部分移动分享页无法下载的问题

<版本 1.17> 2021.10.14
* 代码大幅度重构，降低后续维护难度
* 修复了侧栏在部分页面无法全部展开的问题
* 修复了弹窗有时会误屏蔽或漏屏蔽的问题

<版本 1.16> 2021.10.13
* 修复了在手机分享页内"点击下载"按钮失效的问题
* 在直播详情页内增加了一个"相关直播"的隐藏按钮

<版本 1.15> 2021.10.9
* 屏蔽弹窗功能增加了一个对强制登录弹窗的屏蔽

<版本 1.14> 2021.9.23
* 优化代码结构
* 增加了对"热点"页的支持

<版本 1.13> 2021.9.13
* 增加了对"搜索结果"的支持

<版本 1.12> 2021.9.2
* 增加了对"关注"页的支持

<版本 1.11> 2021.9.2
* 增加了对移动端"分享"页的支持

<版本 1.10> 2021.9.1
* 增加了弹窗屏蔽功能

<版本 1.9> 2021.8.28
* 更新了一波版号(手动滑稽.jpg,主要是这个版本忘记更新内容了)

<版本 1.8> 2021.8.28
* 侧栏展开功能中，把重复的项隐藏了

<版本 1.7> 2021.8.28
* 侧栏展开功能增加了对"直播"主页的支持

<版本 1.6> 2021.8.26
* 修复了下载按钮可能会丢失或错位的问题

<版本 1.5> 2021.8.26
* 下载按钮增加增加了右键获取下载地址的功能

<版本 1.4> 2021.8.26
* 修复了下载按钮可能会丢失或错位的问题

<版本 1.3> 2021.8.26
* 修复了脚本对"主页"支持失效的问题

<版本 1.2> 2021.8.26
* 增加了对"频道"页的支持

<版本 1.1> 2021.8.25
* 增加了脚本图标

<版本 1.0> 2021.8.25
* 可在频道页/视频详情页下载抖音无水印视频（仅仅支持pc版网页，移动端请将浏览器ua改成电脑ua）
